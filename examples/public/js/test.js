// Generated by CoffeeScript 1.3.3
(function() {
  var Clip, ClipCollection, ClipView, Comment, CommentCollection, Project, ProjectView, Track, TrackCollection, TrackView,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Project = (function(_super) {

    __extends(Project, _super);

    function Project() {
      return Project.__super__.constructor.apply(this, arguments);
    }

    Project.prototype.root = true;

    Project.prototype.sharedAttributesKeys = ['title'];

    Project.prototype.sharedCollections = ['tracks'];

    Project.prototype.defaults = {
      title: "New project"
    };

    Project.prototype.initialize = function(project, options) {
      return this.tracks = new TrackCollection(project != null ? project.tracks : void 0);
    };

    return Project;

  })(Backbone.SharedModel);

  Track = (function(_super) {

    __extends(Track, _super);

    function Track() {
      return Track.__super__.constructor.apply(this, arguments);
    }

    Track.prototype.sharedAttributesKeys = ['title'];

    Track.prototype.sharedCollections = ['clips'];

    Track.prototype.defaults = {
      title: "New track"
    };

    Track.prototype.initialize = function(track, options) {
      return this.clips = new ClipCollection(track != null ? track.clips : void 0);
    };

    return Track;

  })(Backbone.SharedModel);

  Clip = (function(_super) {

    __extends(Clip, _super);

    function Clip() {
      return Clip.__super__.constructor.apply(this, arguments);
    }

    Clip.prototype.sharedAttributesKeys = ['position'];

    Clip.prototype.sharedCollections = ['comments'];

    Clip.prototype.defaults = {
      position: 0
    };

    Clip.prototype.initialize = function(clip, options) {
      return this.comments = new CommentCollection(clip != null ? clip.comments : void 0);
    };

    return Clip;

  })(Backbone.SharedModel);

  Comment = (function(_super) {

    __extends(Comment, _super);

    function Comment() {
      return Comment.__super__.constructor.apply(this, arguments);
    }

    Comment.prototype.sharedAttributesKeys = ['content'];

    Comment.prototype.defaults = {
      content: "Comment content test !"
    };

    return Comment;

  })(Backbone.SharedModel);

  TrackCollection = (function(_super) {

    __extends(TrackCollection, _super);

    function TrackCollection() {
      return TrackCollection.__super__.constructor.apply(this, arguments);
    }

    TrackCollection.prototype.path = 'tracks';

    TrackCollection.prototype.model = Track;

    return TrackCollection;

  })(Backbone.SharedCollection);

  ClipCollection = (function(_super) {

    __extends(ClipCollection, _super);

    function ClipCollection() {
      return ClipCollection.__super__.constructor.apply(this, arguments);
    }

    ClipCollection.prototype.path = 'clips';

    ClipCollection.prototype.model = Clip;

    return ClipCollection;

  })(Backbone.SharedCollection);

  CommentCollection = (function(_super) {

    __extends(CommentCollection, _super);

    function CommentCollection() {
      return CommentCollection.__super__.constructor.apply(this, arguments);
    }

    CommentCollection.prototype.path = 'comments';

    CommentCollection.prototype.model = Comment;

    return CommentCollection;

  })(Backbone.SharedCollection);

  ProjectView = (function(_super) {

    __extends(ProjectView, _super);

    function ProjectView() {
      return ProjectView.__super__.constructor.apply(this, arguments);
    }

    ProjectView.prototype.el = $('#project');

    ProjectView.prototype.events = {
      'keyup .project-title': 'updateTitle',
      'click .add-track-btn': 'addTrack',
      'click .add-tracks-with-clips-btn': 'addTracksWithClips'
    };

    ProjectView.prototype.created = false;

    ProjectView.prototype.template = _.template("    <h1>Project</h1>    <input type='text' name='title' value='<%= title %>' class='project-title'>    <button class='add-track-btn' type='button'>Add Track</button>    <button class='add-tracks-with-clips-btn' type='button'>Add Tracks with Clips</button>    <div class='tracks'></div>  ");

    ProjectView.prototype.initialize = function() {
      var _this = this;
      this.model = this.options.model;
      this.model.on('change:title', this.titleChanged, this);
      return this.model.tracks.on("add", function(track) {
        return _this.trackAdded(track);
      });
    };

    ProjectView.prototype.render = function() {
      this.$el.html(this.template(this.model.attributes));
      this.model.tracks.each(this.trackAdded, this);
      return this;
    };

    ProjectView.prototype.titleChanged = function(model, title) {
      return this.$el.find(".project-title").val(title);
    };

    ProjectView.prototype.updateTitle = function(e) {
      return this.model.set({
        title: e.currentTarget.value
      });
    };

    ProjectView.prototype.addTrack = function() {
      return this.model.tracks.add();
    };

    ProjectView.prototype.trackAdded = function(track) {
      var view;
      view = new TrackView({
        model: track
      });
      return this.$('.tracks').append(view.render().el);
    };

    ProjectView.prototype.addTracksWithClips = function() {
      var t;
      this.model.tracks.add({
        title: 'New Tracks with clips',
        clips: [
          {
            position: 0
          }, {
            position: 1
          }
        ]
      });
      t = new Track({
        title: "Wesh",
        collection: this.model.tracks
      });
      t.clips.add([
        {
          position: 5
        }
      ]);
      return this.model.tracks.add(t);
    };

    return ProjectView;

  })(Backbone.View);

  TrackView = (function(_super) {

    __extends(TrackView, _super);

    function TrackView() {
      return TrackView.__super__.constructor.apply(this, arguments);
    }

    TrackView.prototype["class"] = 'track';

    TrackView.prototype.template = _.template("    <h2>Track</h2>    Title: <input type='text' name='tracks[title][]' value='<%= title %>' class='track-title'>    <a href='#' class='delete-track-btn'>Delete</a>    <button class='add-clip-btn' type='button'>Add Clip</button>    <div class='clips'></div>    <br>  ");

    TrackView.prototype.events = {
      'keyup .track-title': 'updateTitle',
      'click .delete-track-btn': 'destroyTrack',
      'click .add-clip-btn': 'addClip'
    };

    TrackView.prototype.initialize = function() {
      this.container = $('#tracks');
      this.model.on('change:title', this.titleChanged, this);
      this.model.on('destroy', this.cleanView, this);
      return this.model.clips.on("add", this.clipAdded, this);
    };

    TrackView.prototype.render = function() {
      this.$el.html(this.template(this.model.attributes));
      this.model.clips.each(this.clipAdded, this);
      return this;
    };

    TrackView.prototype.titleChanged = function(model, title) {
      return this.$el.find(".track-title").val(title);
    };

    TrackView.prototype.updateTitle = function(e) {
      return this.model.set({
        title: e.currentTarget.value
      });
    };

    TrackView.prototype.destroyTrack = function(e) {
      return this.model.destroy();
    };

    TrackView.prototype.addClip = function(e) {
      return this.model.clips.add();
    };

    TrackView.prototype.clipAdded = function(clip) {
      var view;
      view = new ClipView({
        model: clip
      });
      return this.$('.clips').append(view.render().el);
    };

    TrackView.prototype.cleanView = function() {
      return this.$el.remove();
    };

    return TrackView;

  })(Backbone.View);

  ClipView = (function(_super) {

    __extends(ClipView, _super);

    function ClipView() {
      return ClipView.__super__.constructor.apply(this, arguments);
    }

    ClipView.prototype["class"] = 'clip';

    ClipView.prototype.template = _.template("    Clip :    <input type='number' name='clips[position][]' value='<%= position %>' class='clip-position'>    <a href='#' class='delete-clip-btn'>Delete</a>    <br>  ");

    ClipView.prototype.events = {
      'change .clip-position': 'updatePosition',
      'click .delete-clip-btn': 'destroyClip'
    };

    ClipView.prototype.initialize = function() {
      this.model.on('change:position', this.positionChanged, this);
      return this.model.on('destroy', this.cleanView, this);
    };

    ClipView.prototype.render = function(container) {
      this.$el.html(this.template(this.model.attributes));
      return this;
    };

    ClipView.prototype.positionChanged = function(model, position) {
      return this.$('.clip-position').val(position);
    };

    ClipView.prototype.updatePosition = function(e) {
      return this.model.set({
        position: parseInt(e.currentTarget.value, 10)
      });
    };

    ClipView.prototype.destroyClip = function() {
      return this.model.destroy();
    };

    ClipView.prototype.cleanView = function() {
      return this.$el.remove();
    };

    return ClipView;

  })(Backbone.View);

  window.Project = Project;

  window.ProjectView = ProjectView;

}).call(this);
